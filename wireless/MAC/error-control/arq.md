# 自动重传请求 (ARQ - Automatic Repeat reQuest)

## 概述
ARQ是一种错误控制技术，通过自动重传检测到错误或丢失的数据包来提高数据传输的可靠性。

## Stop-and-Wait ARQ - 停止等待ARQ
### 基本原理
- **发送一包**: 一次只发送一个数据包
- **等待确认**: 等待接收方的确认信号
- **超时重传**: 超时后重传数据包
- **顺序传输**: 严格按顺序传输

### 工作机制
1. **发送数据**: 发送方发送数据包
2. **启动定时器**: 启动重传定时器
3. **等待ACK**: 等待接收方确认
4. **处理ACK**: 收到ACK后发送下一包
5. **超时处理**: 超时后重传当前包

### 性能特点
- **简单性**: 实现简单，逻辑清晰
- **可靠性**: 提供可靠的数据传输
- **效率**: 信道利用率较低
- **延迟**: 传输延迟较大

### 效率分析
```
η = 1 / (1 + 2α)
其中：α = 传播时延 / 传输时延
```

## Go-Back-N ARQ - 回退N帧ARQ
### 基本原理
- **连续发送**: 可连续发送多个数据包
- **窗口机制**: 使用发送窗口控制
- **累积确认**: 使用累积确认机制
- **选择重传**: 从错误包开始重传

### 工作机制
1. **窗口发送**: 在窗口内连续发送多个包
2. **序号标记**: 为每个包分配序号
3. **累积确认**: 接收方发送累积确认
4. **窗口滑动**: 收到确认后窗口前移
5. **错误恢复**: 检测到错误后回退重传

### 缓冲需求
- **发送方**: 需要缓冲发送窗口内的所有包
- **接收方**: 只需要缓冲一个包
- **窗口大小**: 通常为2^n - 1

### 性能特点
- **吞吐量**: 比Stop-and-Wait高
- **复杂度**: 实现复杂度适中
- **错误恢复**: 重传开销较大
- **缓冲需求**: 接收方缓冲需求小

## Selective Repeat ARQ - 选择重传ARQ
### 基本原理
- **选择重传**: 只重传错误或丢失的包
- **独立确认**: 每个包独立确认
- **乱序缓冲**: 接收方可缓冲乱序包
- **双窗口**: 发送方和接收方都有窗口

### 工作机制
1. **连续发送**: 在窗口内连续发送包
2. **选择确认**: 对每个包单独确认
3. **乱序处理**: 接收方缓冲乱序包
4. **选择重传**: 只重传未确认的包
5. **窗口管理**: 维护发送和接收窗口

### 确认机制
- **正确确认**: 对正确接收的包发送ACK
- **否定确认**: 对错误包发送NAK
- **定时器**: 为每个包设置定时器

### 性能特点
- **效率**: 最高的信道利用率
- **复杂度**: 实现复杂度最高
- **缓冲需求**: 接收方缓冲需求大
- **错误恢复**: 重传开销最小

## 混合ARQ (HARQ - Hybrid ARQ)
### 基本概念
- **FEC结合**: 结合前向纠错和重传
- **软合并**: 利用重传包的软信息
- **增量冗余**: 逐步增加冗余信息
- **自适应**: 根据信道条件自适应

### Type I HARQ
- **简单重传**: 检测到错误后重传原包
- **FEC编码**: 每个包都包含FEC编码
- **软合并**: 可以进行软合并
- **实现**: 实现相对简单

### Type II HARQ
- **增量冗余**: 重传时发送额外的冗余信息
- **码率自适应**: 根据需要调整码率
- **软合并**: 结合原包和重传包的信息
- **复杂度**: 实现复杂度较高

### Type III HARQ
- **自包含**: 每个重传包都是自包含的
- **可独立解码**: 每个包都可独立解码
- **灵活性**: 提供更大的灵活性
- **应用**: 适用于变化环境

## ARQ性能分析
### 吞吐量分析
- **理想吞吐量**: 无错误时的吞吐量
- **实际吞吐量**: 考虑错误和重传的吞吐量
- **效率公式**: 
  ```
  η = (1-P) / (1 + 2αP)
  其中：P为包错误率
  ```

### 延迟分析
- **传输延迟**: 包传输时间
- **传播延迟**: 信号传播时间
- **处理延迟**: 发送和接收处理时间
- **重传延迟**: 重传引起的额外延迟

### 缓冲需求分析
- **发送缓冲**: 发送方需要的缓冲大小
- **接收缓冲**: 接收方需要的缓冲大小
- **窗口大小**: 窗口大小对缓冲需求的影响

## 定时器管理
### 重传定时器
- **RTO计算**: 重传超时时间计算
- **自适应**: 根据RTT自适应调整
- **抖动**: 考虑RTT的抖动
- **指数退避**: 连续重传时的退避

### 确认定时器
- **延迟确认**: 延迟发送确认
- **累积确认**: 累积多个确认
- **超时确认**: 超时后强制确认

### 定时器优化
- **精确估计**: 更精确的RTT估计
- **快速恢复**: 快速重传和恢复
- **拥塞控制**: 结合拥塞控制调整

## 序号管理
### 序号空间
- **序号长度**: 序号字段的长度
- **序号范围**: 可用序号的范围
- **回绕处理**: 序号回绕的处理

### 窗口管理
- **发送窗口**: 发送方窗口管理
- **接收窗口**: 接收方窗口管理
- **窗口同步**: 发送和接收窗口的同步

### 重复检测
- **重复包**: 检测重复数据包
- **重复确认**: 处理重复确认
- **状态维护**: 维护重复检测状态

## 错误恢复策略
### 快速重传
- **重复确认**: 基于重复确认的快速重传
- **选择确认**: 使用选择确认信息
- **早期检测**: 早期检测包丢失

### 拥塞避免
- **拥塞检测**: 检测网络拥塞
- **速率控制**: 控制发送速率
- **退避算法**: 拥塞时的退避策略

### 自适应机制
- **信道估计**: 估计信道质量
- **参数调整**: 根据信道调整参数
- **模式切换**: 在不同模式间切换

## 应用实例
### TCP协议
- **可靠性**: 提供可靠的字节流服务
- **流量控制**: 结合流量控制机制
- **拥塞控制**: 结合拥塞控制算法

### 无线链路
- **802.11 WiFi**: 使用Stop-and-Wait ARQ
- **802.16 WiMAX**: 使用Selective Repeat ARQ
- **LTE**: 使用Hybrid ARQ

### 卫星通信
- **长延迟**: 适应长传播延迟
- **高错误率**: 处理高错误率环境
- **带宽限制**: 考虑带宽限制

## 优化技术
### 跨层优化
- **PHY层信息**: 利用物理层信息
- **网络层协作**: 与网络层协作
- **应用层感知**: 考虑应用层需求

### 多路径ARQ
- **路径分集**: 利用多条路径
- **负载均衡**: 在多路径间均衡负载
- **容错性**: 提高系统容错性

### 自适应ARQ
- **环境感知**: 感知环境变化
- **参数调整**: 自适应调整参数
- **性能优化**: 优化系统性能

## 发展趋势
### 智能ARQ
- **机器学习**: 利用机器学习优化
- **预测重传**: 预测性重传机制
- **智能调度**: 智能重传调度

### 5G/6G ARQ
- **超低延迟**: 满足超低延迟需求
- **高可靠性**: 提供高可靠性保证
- **大规模连接**: 支持大规模连接

### 边缘计算ARQ
- **边缘处理**: 在边缘进行ARQ处理
- **本地化**: 本地化错误恢复
- **协同机制**: 云边协同的ARQ机制 